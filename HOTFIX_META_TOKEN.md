# üö® HOTFIX: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å META_ACCESS_TOKEN

## –î–∏–∞–≥–Ω–æ–∑ –ø—Ä–æ–±–ª–µ–º—ã

**–ö–æ–º–º–∏—Ç c00787e –ù–ï –≤–∏–Ω–æ–≤–∞—Ç!** –ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–æ–º, —á—Ç–æ `META_ACCESS_TOKEN` –Ω–∞ Railway –Ω–µ –∏–º–µ–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Ad Account.

**–û—à–∏–±–∫–∞ Meta API:**
```
(#200) Ad account owner has NOT grant ads_management or ads_read permission
```

**–°—Ç–∞—Ç—É—Å –∫–æ–¥:** 403 (Forbidden)
**–¢–∏–ø:** OAuthException

---

## üîß –†–µ—à–µ–Ω–∏–µ (2 –≤–∞—Ä–∏–∞–Ω—Ç–∞)

### –í–∞—Ä–∏–∞–Ω—Ç 1: –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

#### –®–∞–≥ 1: –ó–∞–π—Ç–∏ –≤ Facebook Business Manager

1. –û—Ç–∫—Ä—ã—Ç—å: https://business.facebook.com/settings/system-users
2. –í–æ–π—Ç–∏ –ø–æ–¥ —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å—å—é –≤–ª–∞–¥–µ–ª—å—Ü–∞ Ad Account

#### –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å System User (–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç)

1. –ù–∞–∂–∞—Ç—å **Add** ‚Üí **Add System User**
2. –ò–º—è: `ecademy_analytics_bot`
3. –†–æ–ª—å: **Admin** (–¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ Ads API)
4. –ù–∞–∂–∞—Ç—å **Create System User**

#### –®–∞–≥ 3: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å Access Token

1. –í—ã–±—Ä–∞—Ç—å —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ System User
2. –ù–∞–∂–∞—Ç—å **Generate New Token**
3. –í—ã–±—Ä–∞—Ç—å Ad Account: `Act 1403989946628902`
4. **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** –æ—Ç–º–µ—Ç–∏—Ç—å permissions:
   - ‚úÖ `ads_read` - –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ä–µ–∫–ª–∞–º—ã
   - ‚úÖ `ads_management` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∫–ª–∞–º–æ–π (–≤–∫–ª—é—á–∞–µ—Ç ads_read)
   - ‚úÖ `read_insights` - –ß—Ç–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
5. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: **60 days** –∏–ª–∏ **Never expire** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏)
6. –ù–∞–∂–∞—Ç—å **Generate Token**
7. **–°–ö–û–ü–ò–†–û–í–ê–¢–¨ –¢–û–ö–ï–ù** (–æ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑!)

#### –®–∞–≥ 4: –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –Ω–∞ Railway

1. –ó–∞–π—Ç–∏ –≤ Railway: https://railway.app
2. –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ–µ–∫—Ç: `facebook-ads-analytics-exporter-production`
3. –ü–µ—Ä–µ–π—Ç–∏ –≤ **Variables**
4. –ù–∞–π—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `META_ACCESS_TOKEN`
5. –ù–∞–∂–∞—Ç—å **Edit** ‚Üí –í—Å—Ç–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω
6. –ù–∞–∂–∞—Ç—å **Save**
7. Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç —Å–µ—Ä–≤–∏—Å

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –û–±–Ω–æ–≤–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ç–æ–∫–µ–Ω–∞

–ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –±—ã–ª —Å–æ–∑–¥–∞–Ω –Ω–µ–¥–∞–≤–Ω–æ –∏ –ø—Ä–æ—Å—Ç–æ –Ω–µ –∏–º–µ–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π:

1. –ó–∞–π—Ç–∏ –≤ https://business.facebook.com/settings/system-users
2. –ù–∞–π—Ç–∏ System User –∫–æ—Ç–æ—Ä—ã–π —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª —Ç–æ–∫–µ–Ω
3. –ù–∞–∂–∞—Ç—å **Reassign Assets**
4. –ù–∞–π—Ç–∏ Ad Account `Act 1403989946628902`
5. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –æ—Ç–º–µ—á–µ–Ω—ã:
   - ‚úÖ **Manage campaigns** (ads_management)
   - ‚úÖ **View performance** (read_insights)
6. –ù–∞–∂–∞—Ç—å **Save Changes**
7. **–í–∞–∂–Ω–æ:** –ú–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ (–®–∞–≥ 3 –∏–∑ –í–∞—Ä–∏–∞–Ω—Ç–∞ 1)

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ –Ω–æ–≤–æ–º—É —Ç–æ–∫–µ–Ω—É)

```bash
cd D:\Automation\Development\projects\ecademy

# –û–±–Ω–æ–≤–∏—Ç—å .env —Å –Ω–æ–≤—ã–º —Ç–æ–∫–µ–Ω–æ–º
# META_ACCESS_TOKEN=<–Ω–æ–≤—ã–π_—Ç–æ–∫–µ–Ω>

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç
python debug_meta_api.py
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ –£–°–ü–ï–•: Insights –ø–æ–ª—É—á–µ–Ω—ã!
–ü–æ–ª—É—á–µ–Ω–æ insights: <–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ>
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ Railway Production

1. –û—Ç–∫—Ä—ã—Ç—å UI: https://facebook-ads-analytics-exporter-production.up.railway.app
2. –ü–µ—Ä–µ–π—Ç–∏ –≤ **–ê–ù–ê–õ–Ü–ó**
3. –í—ã–±—Ä–∞—Ç—å –ø–µ—Ä–∏–æ–¥: **2025-10-05 - 2025-10-11** (—Ç–æ—Ç –∂–µ —á—Ç–æ –±—ã–ª –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ)
4. –ù–∞–∂–∞—Ç—å **–°–¢–ê–†–¢**

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–û—Ç—Ä–∏–º–∞–Ω–æ —Ä–µ–∫–ª–∞–º–Ω–∏—Ö –∫–∞–º–ø–∞–Ω—ñ–π: <—á–∏—Å–ª–æ –±–æ–ª—å—à–µ 0>
–û—Ç—Ä–∏–º–∞–Ω–æ —Å—Ç—É–¥–µ–Ω—Ç—Å—å–∫–∏—Ö –∫–∞–º–ø–∞–Ω—ñ–π: <—á–∏—Å–ª–æ>
–û—Ç—Ä–∏–º–∞–Ω–æ –≤–∏–∫–ª–∞–¥–∞—Ü—å–∫–∏—Ö –∫–∞–º–ø–∞–Ω—ñ–π: <—á–∏—Å–ª–æ>
```

---

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

### 1. –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å AD_ACCOUNT_ID

```bash
# –í Railway Variables –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
META_AD_ACCOUNT_ID=act_1403989946628902
```

–§–æ—Ä–º–∞—Ç **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `act_<—á–∏—Å–ª–æ–≤–æ–π_id>`, –ù–ï –ø—Ä–æ—Å—Ç–æ —á–∏—Å–ª–æ–≤–æ–π ID!

### 2. –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–∞

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–∞:
```bash
curl -X GET "https://graph.facebook.com/v21.0/debug_token?input_token=<–≤–∞—à_—Ç–æ–∫–µ–Ω>&access_token=<–≤–∞—à_—Ç–æ–∫–µ–Ω>"
```

–í –æ—Ç–≤–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
```json
{
  "data": {
    "is_valid": true,  // –î–æ–ª–∂–Ω–æ –±—ã—Ç—å true
    "expires_at": 0,   // 0 = Never expire
    "scopes": [        // –î–æ–ª–∂–Ω—ã –±—ã—Ç—å ads_read –∏–ª–∏ ads_management
      "ads_read",
      "read_insights"
    ]
  }
}
```

### 3. –õ–æ–≥–∏ Railway

–ï—Å–ª–∏ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ —Ä–∞–≤–Ω–æ 0 –∫–∞–º–ø–∞–Ω–∏–π:

1. –ó–∞–π—Ç–∏ –≤ Railway ‚Üí Deployments ‚Üí Latest deployment
2. –û—Ç–∫—Ä—ã—Ç—å **Logs**
3. –ò—Å–∫–∞—Ç—å —Å—Ç—Ä–æ–∫–∏:
   - `Received {N} insights from Meta API` - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å N > 0
   - `OAuthException` - –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å
   - `Fetching Meta data for period` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–∏–æ–¥

---

## üìù –ö–æ–º–º–∏—Ç –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç —É–∂–µ —Å–æ–∑–¥–∞–Ω: `debug_meta_api.py`

–≠—Ç–æ—Ç —Ñ–∞–π–ª –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞ –≤ –±—É–¥—É—â–µ–º.

**–ù–ï –ù–£–ñ–ù–û –∫–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ .env —Å –Ω–∞—Å—Ç–æ—è—â–∏–º —Ç–æ–∫–µ–Ω–æ–º!** (.env —É–∂–µ –≤ .gitignore)

---

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞ –ù–ï –≤ –∫–æ–¥–µ**, –∞ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–∞ –Ω–∞ Railway.

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è `META_ACCESS_TOKEN` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏ (`ads_management` –∏–ª–∏ `ads_read`) –≤—Å–µ –¥–æ–ª–∂–Ω–æ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å.

**–ö–æ–º–º–∏—Ç c00787e –±–µ–∑–æ–ø–∞—Å–µ–Ω** - –æ–Ω –∏–∑–º–µ–Ω–∏–ª —Ç–æ–ª—å–∫–æ CRM –∫–æ–¥ (AlfaCRM —Å—Ç–∞—Ç—É—Å—ã) –∏ –Ω–∏–∫–∞–∫ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ Meta API.
